local XenoHub = {
    visible = false,
    minimized = false,
    tabs = {},
    activeTab = 1,
    position = {x = 50, y = 50},
    size = {width = 400, height = 500},
    minimizedSize = {width = 400, height = 40},
    dragOffset = {x = 0, y = 0},
    isDragging = false,
    isDraggingSmallBox = false,
    smallBox = {x = 20, y = 20, size = 15},
    animation = {progress = 0, duration = 0.3, easing = function(t) return t^2 end},
    introAnimation = {progress = 0, duration = 2, showing = true, visible = true},
    tabScroll = 0,
    contentScroll = 0,
    maxTabScroll = 0,
    maxContentScroll = 0
}

-- ألوان القائمة
XenoHub.colors = {
    background = {0.1, 0.1, 0.1, 0.95},
    header = {0.15, 0.15, 0.15, 1},
    tab = {0.2, 0.2, 0.2, 1},
    activeTab = {0.3, 0.3, 0.3, 1},
    text = {1, 1, 1, 1},
    smallBox = {1, 1, 1, 1},
    closeButton = {1, 0.3, 0.3, 1},
    minimizeButton = {0.3, 1, 0.3, 1}
}

-- تهيئة القائمة
function XenoHub.init()
    -- إضافة بعض التبويبات والأزرار كمثال
    XenoHub.addTab("الرئيسية")
    XenoHub.addTab("الإعدادات")
    XenoHub.addTab("المظهر")
    XenoHub.addTab("المزيد")
    
    -- إضافة عناصر للتبويبات
    XenoHub.addButton(1, "تفعيل الهاك", function() print("تم تفعيل الهاك") end, "hack_icon")
    XenoHub.addButton(1, "سرعة عالية", function() print("تم تفعيل السرعة") end, "speed_icon")
    XenoHub.addButton(2, "تغيير الخلفية", function() print("تم تغيير الخلفية") end, "bg_icon")
    XenoHub.addButton(3, "تغيير اللون", function() print("تم تغيير اللون") end, "color_icon")
    
    -- حساب أقصى scroll للتبويبات
    XenoHub.updateScrollValues()
end

-- إضافة تبويب جديد
function XenoHub.addTab(name)
    table.insert(XenoHub.tabs, {
        name = name,
        buttons = {},
        images = {}
    })
    XenoHub.updateScrollValues()
end

-- إضافة زر إلى تبويب
function XenoHub.addButton(tabIndex, text, callback, imageId)
    local tab = XenoHub.tabs[tabIndex]
    if tab then
        table.insert(tab.buttons, {
            text = text,
            callback = callback,
            imageId = imageId
        })
        XenoHub.updateScrollValues()
    end
end

-- تحديث قيم الـ scroll
function XenoHub.updateScrollValues()
    -- حساب أقصى scroll للتبويبات
    local tabWidth = 100
    local totalTabsWidth = #XenoHub.tabs * tabWidth
    local availableTabsWidth = XenoHub.size.width - 20
    XenoHub.maxTabScroll = math.max(0, totalTabsWidth - availableTabsWidth)
    
    -- حساب أقصى scroll للمحتوى
    local buttonHeight = 40
    local totalContentHeight = #XenoHub.tabs[XenoHub.activeTab].buttons * buttonHeight
    local availableContentHeight = XenoHub.size.height - 80
    XenoHub.maxContentScroll = math.max(0, totalContentHeight - availableContentHeight)
end

-- تبديل ظهور القائمة
function XenoHub.toggle()
    XenoHub.visible = not XenoHub.visible
    XenoHub.animation.progress = 0
end

-- تبديل التصغير
function XenoHub.toggleMinimize()
    XenoHub.minimized = not XenoHub.minimized
    XenoHub.animation.progress = 0
end

-- تحديث الأنيميشن
function XenoHub.update(dt)
    -- تحديث أنيميشن القائمة
    if XenoHub.animation.progress < 1 then
        XenoHub.animation.progress = math.min(1, XenoHub.animation.progress + dt / XenoHub.animation.duration)
    end
    
    -- تحديث أنيميشن الإنترو
    if XenoHub.introAnimation.visible then
        if XenoHub.introAnimation.showing then
            XenoHub.introAnimation.progress = math.min(1, XenoHub.introAnimation.progress + dt / XenoHub.introAnimation.duration)
            if XenoHub.introAnimation.progress == 1 then
                XenoHub.introAnimation.showing = false
                XenoHub.introAnimation.timer = 5 -- 5 ثواني قبل الاختفاء
            end
        else
            if XenoHub.introAnimation.timer then
                XenoHub.introAnimation.timer = XenoHub.introAnimation.timer - dt
                if XenoHub.introAnimation.timer <= 0 then
                    XenoHub.introAnimation.progress = math.max(0, XenoHub.introAnimation.progress - dt / XenoHub.introAnimation.duration)
                    if XenoHub.introAnimation.progress == 0 then
                        XenoHub.introAnimation.visible = false
                    end
                end
            end
        end
    end
end

-- رسم القائمة
function XenoHub.draw()
    -- رسم إنترو القائمة
    if XenoHub.introAnimation.visible then
        local introWidth = 200 * XenoHub.introAnimation.progress
        local introHeight = 50 * XenoHub.introAnimation.progress
        local introX = (love.graphics.getWidth() - introWidth) / 2
        local introY = (love.graphics.getHeight() - introHeight) / 2
        
        love.graphics.setColor(0, 0, 0, 0.8)
        love.graphics.rectangle("fill", introX, introY, introWidth, introHeight, 5, 5)
        
        love.graphics.setColor(1, 1, 1, 1)
        local font = love.graphics.newFont(20)
        love.graphics.setFont(font)
        love.graphics.printf("Xeno Hub 999", introX, introY + introHeight/2 - 10, introWidth, "center")
    end
    
    -- إذا كانت القائمة غير ظاهرة لا نرسمها
    if not XenoHub.visible and XenoHub.animation.progress >= 1 then return end
    
    -- حساب تأثير الأنيميشن
    local animValue = XenoHub.animation.easing(XenoHub.animation.progress)
    local currentAlpha = XenoHub.visible and animValue or (1 - animValue)
    local currentSize = XenoHub.minimized and XenoHub.minimizedSize or XenoHub.size
    
    -- إذا كانت القائمة مصغرة ونحن نغلقها، نستخدم أنيميشن التصغير
    if XenoHub.minimized and not XenoHub.visible then
        currentSize.height = XenoHub.minimizedSize.height + (XenoHub.size.height - XenoHub.minimizedSize.height) * (1 - animValue)
    end
    
    -- رسم خلفية القائمة
    love.graphics.setColor(XenoHub.colors.background[1], XenoHub.colors.background[2], 
                          XenoHub.colors.background[3], XenoHub.colors.background[4] * currentAlpha)
    love.graphics.rectangle("fill", XenoHub.position.x, XenoHub.position.y, 
                           currentSize.width, currentSize.height, 5, 5)
    
    -- رسم رأس القائمة
    love.graphics.setColor(XenoHub.colors.header[1], XenoHub.colors.header[2], 
                          XenoHub.colors.header[3], XenoHub.colors.header[4] * currentAlpha)
    love.graphics.rectangle("fill", XenoHub.position.x, XenoHub.position.y, 
                           currentSize.width, 30, 5, 5, 5, 0)
    
    -- نص رأس القائمة
    love.graphics.setColor(XenoHub.colors.text[1], XenoHub.colors.text[2], 
                          XenoHub.colors.text[3], XenoHub.colors.text[4] * currentAlpha)
    love.graphics.print("Xeno Hub 999", XenoHub.position.x + 10, XenoHub.position.y + 8)
    
    -- زر الإغلاق
    love.graphics.setColor(XenoHub.colors.closeButton[1], XenoHub.colors.closeButton[2], 
                          XenoHub.colors.closeButton[3], XenoHub.colors.closeButton[4] * currentAlpha)
    love.graphics.print("✖", XenoHub.position.x + currentSize.width - 30, XenoHub.position.y + 8)
    
    -- زر التصغير
    love.graphics.setColor(XenoHub.colors.minimizeButton[1], XenoHub.colors.minimizeButton[2], 
                          XenoHub.colors.minimizeButton[3], XenoHub.colors.minimizeButton[4] * currentAlpha)
    love.graphics.print(XenoHub.minimized and "+" or "-", XenoHub.position.x + currentSize.width - 60, XenoHub.position.y + 8)
    
    -- إذا كانت القائمة مصغرة لا نرسم باقي العناصر
    if XenoHub.minimized then return end
    
    -- رسم التبويبات
    love.graphics.setColor(XenoHub.colors.tab[1], XenoHub.colors.tab[2], 
                          XenoHub.colors.tab[3], XenoHub.colors.tab[4] * currentAlpha)
    love.graphics.rectangle("fill", XenoHub.position.x + 10, XenoHub.position.y + 35, 
                           currentSize.width - 20, 30, 3, 3)
    
    -- رسم كل تبويب
    local tabX = XenoHub.position.x + 15 - XenoHub.tabScroll
    for i, tab in ipairs(XenoHub.tabs) do
        if i == XenoHub.activeTab then
            love.graphics.setColor(XenoHub.colors.activeTab[1], XenoHub.colors.activeTab[2], 
                                 XenoHub.colors.activeTab[3], XenoHub.colors.activeTab[4] * currentAlpha)
        else
            love.graphics.setColor(XenoHub.colors.tab[1], XenoHub.colors.tab[2], 
                                 XenoHub.colors.tab[3], XenoHub.colors.tab[4] * currentAlpha)
        end
        
        love.graphics.rectangle("fill", tabX, XenoHub.position.y + 37, 90, 26, 3, 3)
        
        love.graphics.setColor(XenoHub.colors.text[1], XenoHub.colors.text[2], 
                             XenoHub.colors.text[3], XenoHub.colors.text[4] * currentAlpha)
        love.graphics.print(tab.name, tabX + 5, XenoHub.position.y + 42)
        
        tabX = tabX + 100
    end
    
    -- رسم محتوى التبويب النشط
    local contentY = XenoHub.position.y + 75 - XenoHub.contentScroll
    for i, button in ipairs(XenoHub.tabs[XenoHub.activeTab].buttons) do
        love.graphics.setColor(0.2, 0.2, 0.2, 0.7 * currentAlpha)
        love.graphics.rectangle("fill", XenoHub.position.x + 10, contentY, currentSize.width - 20, 35, 3, 3)
        
        -- هنا يمكنك رسم الصورة إذا كانت موجودة
        -- love.graphics.draw(button.image, XenoHub.position.x + 15, contentY + 5)
        
        love.graphics.setColor(XenoHub.colors.text[1], XenoHub.colors.text[2], 
                             XenoHub.colors.text[3], XenoHub.colors.text[4] * currentAlpha)
        love.graphics.print(button.text, XenoHub.position.x + 15, contentY + 10)
        
        contentY = contentY + 40
    end
    
    -- رسم المربع الصغير المتحرك
    love.graphics.setColor(XenoHub.colors.smallBox[1], XenoHub.colors.smallBox[2], 
                         XenoHub.colors.smallBox[3], XenoHub.colors.smallBox[4] * currentAlpha)
    love.graphics.rectangle("fill", XenoHub.smallBox.x, XenoHub.smallBox.y, 
                          XenoHub.smallBox.size, XenoHub.smallBox.size)
end

-- معالجة أحداث الفأرة
function XenoHub.mousepressed(x, y, button)
    if button == 1 then -- زر الفأرة الأيسر
        -- التحقق من إنترو القائمة
        if XenoHub.introAnimation.visible then
            XenoHub.introAnimation.visible = false
            XenoHub.visible = true
            XenoHub.animation.progress = 0
            return
        end
        
        -- التحقق من المربع الصغير
        if x >= XenoHub.smallBox.x and x <= XenoHub.smallBox.x + XenoHub.smallBox.size and
           y >= XenoHub.smallBox.y and y <= XenoHub.smallBox.y + XenoHub.smallBox.size then
            XenoHub.isDraggingSmallBox = true
            XenoHub.smallBox.dragOffset = {x = x - XenoHub.smallBox.x, y = y - XenoHub.smallBox.y}
            return
        end
        
        -- إذا كانت القائمة مصغرة
        if XenoHub.minimized then
            if XenoHub.visible then
                -- التحقق من زر التصغير/التكبير
                if x >= XenoHub.position.x + XenoHub.minimizedSize.width - 60 and x <= XenoHub.position.x + XenoHub.minimizedSize.width - 40 and
                   y >= XenoHub.position.y + 8 and y <= XenoHub.position.y + 22 then
                    XenoHub.toggleMinimize()
                    return
                end
                
                -- التحقق من زر الإغلاق
                if x >= XenoHub.position.x + XenoHub.minimizedSize.width - 30 and x <= XenoHub.position.x + XenoHub.minimizedSize.width - 10 and
                   y >= XenoHub.position.y + 8 and y <= XenoHub.position.y + 22 then
                    XenoHub.toggle()
                    return
                end
                
                -- بدء سحب رأس القائمة
                if x >= XenoHub.position.x and x <= XenoHub.position.x + XenoHub.minimizedSize.width and
                   y >= XenoHub.position.y and y <= XenoHub.position.y + 30 then
                    XenoHub.isDragging = true
                    XenoHub.dragOffset = {x = x - XenoHub.position.x, y = y - XenoHub.position.y}
                    return
                end
            end
            return
        end
        
        -- إذا كانت القائمة غير مصغرة
        if XenoHub.visible then
            -- التحقق من زر التصغير/التكبير
            if x >= XenoHub.position.x + XenoHub.size.width - 60 and x <= XenoHub.position.x + XenoHub.size.width - 40 and
               y >= XenoHub.position.y + 8 and y <= XenoHub.position.y + 22 then
                XenoHub.toggleMinimize()
                return
            end
            
            -- التحقق من زر الإغلاق
            if x >= XenoHub.position.x + XenoHub.size.width - 30 and x <= XenoHub.position.x + XenoHub.size.width - 10 and
               y >= XenoHub.position.y + 8 and y <= XenoHub.position.y + 22 then
                XenoHub.toggle()
                return
            end
            
            -- بدء سحب رأس القائمة
            if x >= XenoHub.position.x and x <= XenoHub.position.x + XenoHub.size.width and
               y >= XenoHub.position.y and y <= XenoHub.position.y + 30 then
                XenoHub.isDragging = true
                XenoHub.dragOffset = {x = x - XenoHub.position.x, y = y - XenoHub.position.y}
                return
            end
            
            -- التحقق من التبويبات
            if y >= XenoHub.position.y + 35 and y <= XenoHub.position.y + 65 then
                local tabX = XenoHub.position.x + 15 - XenoHub.tabScroll
                for i, tab in ipairs(XenoHub.tabs) do
                    if x >= tabX and x <= tabX + 90 then
                        XenoHub.activeTab = i
                        XenoHub.contentScroll = 0
                        XenoHub.updateScrollValues()
                        return
                    end
                    tabX = tabX + 100
                end
            end
            
            -- التحقق من الأزرار في التبويب النشط
            if y >= XenoHub.position.y + 75 and y <= XenoHub.position.y + XenoHub.size.height - 5 then
                local buttonIndex = math.floor((y - XenoHub.position.y - 75 + XenoHub.contentScroll) / 40) + 1
                local buttons = XenoHub.tabs[XenoHub.activeTab].buttons
                if buttonIndex >= 1 and buttonIndex <= #buttons then
                    buttons[buttonIndex].callback()
                    return
                end
            end
        end
    end
end

function XenoHub.mousereleased(x, y, button)
    if button == 1 then
        XenoHub.isDragging = false
        XenoHub.isDraggingSmallBox = false
    end
end

function XenoHub.mousemoved(x, y, dx, dy)
    -- تحريك المربع الصغير
    if XenoHub.isDraggingSmallBox then
        XenoHub.smallBox.x = x - XenoHub.smallBox.dragOffset.x
        XenoHub.smallBox.y = y - XenoHub.smallBox.dragOffset.y
        return
    end
    
    -- تحريك القائمة
    if XenoHub.isDragging then
        XenoHub.position.x = x - XenoHub.dragOffset.x
        XenoHub.position.y = y - XenoHub.dragOffset.y
        return
    end
end

function XenoHub.wheelmoved(x, y)
    if XenoHub.visible and not XenoHub.minimized then
        -- Scroll التبويبات (أفقي)
        if love.keyboard.isDown("lctrl") or love.keyboard.isDown("rctrl") then
            XenoHub.tabScroll = math.max(0, math.min(XenoHub.maxTabScroll, XenoHub.tabScroll - x * 20))
        -- Scroll المحتوى (عمودي)
        else
            XenoHub.contentScroll = math.max(0, math.min(XenoHub.maxContentScroll, XenoHub.contentScroll - y * 20))
        end
    end
end

-- تهيئة القائمة عند البدء
XenoHub.init()

-- مثال استخدام في Love2D
function love.load()
    -- يمكنك ضبط حجم النافذة هنا
    love.window.setMode(800, 600)
end

function love.update(dt)
    XenoHub.update(dt)
end

function love.draw()
    XenoHub.draw()
end

function love.mousepressed(x, y, button)
    XenoHub.mousepressed(x, y, button)
end

function love.mousereleased(x, y, button)
    XenoHub.mousereleased(x, y, button)
end

function love.mousemoved(x, y, dx, dy)
    XenoHub.mousemoved(x, y, dx, dy)
end

function love.wheelmoved(x, y)
    XenoHub.wheelmoved(x, y)
end

function love.keypressed(key)
    if key == "f1" then
        XenoHub.toggle()
    end
end
